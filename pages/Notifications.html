<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SafeHeart Notifications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        body {
            background: linear-gradient(to right, #e0f7fa, #ffffff);
            font-family: 'Segoe UI', sans-serif;
        }

        .notification-card {
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

        .notification-card.read {
            opacity: 0.6;
        }

        .swipe-wrapper {
            overflow: hidden;
            position: relative;
        }

        .swipe-content {
            transition: transform 0.3s ease;
            will-change: transform;
        }

        .container-main {
            padding-bottom: 100px;
            max-width: 500px;
            margin: auto;
            padding-top: 20px;
        }

        .welcome-card {
            background: linear-gradient(135deg, #f0f8ff, #ffffff);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .welcome-card:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 16px rgba(0, 123, 255, 0.2);
        }

        .nav-link-custom {
            color: #6c757d;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link-custom:hover,
        .nav-link-custom.active {
            color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 10px;
        }

        .bottom-nav-container {
            width: 100%;
            max-width: 700px;
            /* background-color: #ffffffcc; ÿÆŸÑŸÅŸäÿ© ÿ®Ÿäÿ∂ÿßÿ° ÿ¥ÿ®Ÿá ÿ¥ŸÅÿßŸÅÿ© */
            border-radius: 15px;
            position: fixed;
            /*=======================*/
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;

            bottom: 0;
        }
    </style>
</head>

<body>

    <h4 class="text-center text-primary mb-5"></h4>

    <h4 class="text-center text-primary mb-4"><i class="fas fa-bell"></i> Notifications</h4>

    <div class="container-main">
        <!-- ÿ•ÿ¥ÿπÿßÿ± ÿØÿßÿ¶ŸÖ SafeHeart -->
        <div
            class="notification-card bg-white border-start border-primary border-4 rounded shadow-sm p-3 mb-4 d-flex align-items-start welcome-card">
            <div class="text-primary me-3"><i class="fas fa-shield-heart fa-2x"></i></div>
            <div class="flex-grow-1">
                <h6 class="mb-1 fw-bold">Safe Heart</h6>
                <p class="mb-0 text-muted small">ÿµÿ≠ÿ™ŸÉ ÿØÿßŸäŸÖŸãÿß ŸÅŸä ÿ£ŸÖÿßŸÜÿå ŸÑÿß ÿ™ŸÇŸÑŸÇÿå ÿßÿ∑ŸÖÿ¶ŸÜ üíô</p>
            </div>
        </div>

        <!-- Heart Alert -->
        <div class="swipe-wrapper d-none" id="heartAlert">
            <div
                class="notification-card swipe-content bg-white border-start border-danger border-4 rounded shadow-sm p-3 mb-3 d-flex align-items-start">
                <div class="text-danger me-3"><i class="fas fa-heartbeat fa-2x"></i></div>
                <div class="flex-grow-1">
                    <h6 class="mb-1 fw-bold">Heart Rate Alert</h6>
                    <p class="mb-1 text-muted small">Your heart rate is abnormal.</p>
                    <span class="text-secondary small" id="heart-time"></span>
                </div>
            </div>
        </div>

        <!-- Temperature Alert -->
        <div class="swipe-wrapper d-none" id="tempAlert">
            <div
                class="notification-card swipe-content bg-white border-start border-warning border-4 rounded shadow-sm p-3 mb-3 d-flex align-items-start">
                <div class="text-warning me-3"><i class="fas fa-thermometer-half fa-2x"></i></div>
                <div class="flex-grow-1">
                    <h6 class="mb-1 fw-bold">High Temperature</h6>
                    <p class="mb-1 text-muted small">Body temperature is high.</p>
                    <span class="text-secondary small" id="temp-time"></span>
                </div>
            </div>
        </div>

        <!-- SpO2 Alert -->
        <div class="swipe-wrapper d-none" id="spo2Alert">
            <div
                class="notification-card swipe-content bg-white border-start border-info border-4 rounded shadow-sm p-3 mb-3 d-flex align-items-start">
                <div class="text-info me-3"><i class="fas fa-lungs fa-2x"></i></div>
                <div class="flex-grow-1">
                    <h6 class="mb-1 fw-bold">Low SpO‚ÇÇ</h6>
                    <p class="mb-1 text-muted small">Oxygen level is low.</p>
                    <span class="text-secondary small" id="spo2-time"></span>
                </div>
            </div>
        </div>

        <!-- Good Health Alert -->
        <div class="swipe-wrapper d-none" id="goodAlert">
            <div
                class="notification-card swipe-content bg-white border-start border-success border-4 rounded shadow-sm p-3 mb-3 d-flex align-items-start">
                <div class="text-success me-3"><i class="fas fa-smile-beam fa-2x"></i></div>
                <div class="flex-grow-1">
                    <h6 class="mb-1 fw-bold">You're doing well!</h6>
                    <p class="mb-1 text-muted small">All vitals are normal. Keep it up!</p>
                    <span class="text-secondary small" id="good-time"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav-container shadow-sm mt-4 mx-auto">
        <div class="d-flex justify-content-around py-3">
            <a href="homeDashboard.html" class="text-decoration-none text-center flex-fill nav-link-custom">
                <i class="fas fa-home fa-lg d-block mb-1"></i>
                <small>Home</small>
            </a>
            <a href="HealthHistory.html" class="text-decoration-none text-center flex-fill nav-link-custom">
                <i class="fas fa-history fa-lg d-block mb-1"></i>
                <small>History</small>
            </a>
            <a href="Notifications.html" class="text-decoration-none text-center flex-fill nav-link-custom">
                <i class="fas fa-bell fa-lg d-block mb-1"></i>
                <small>Notifications</small>
            </a>
            <a href="profile.html" class="text-decoration-none text-center flex-fill nav-link-custom">
                <i class="fas fa-user fa-lg d-block mb-1"></i>
                <small>Profile</small>
            </a>
        </div>
    </div>


    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCA-QB0_T3Ano-0iIy7XME-opFc6MZXzRg",
            authDomain: "safeheart-2d878.firebaseapp.com",
            databaseURL: "https://safeheart-2d878-default-rtdb.firebaseio.com",
            projectId: "safeheart-2d878",
            storageBucket: "safeheart-2d878.appspot.com",
            messagingSenderId: "968110391488",
            appId: "1:968110391488:web:235a04d5b59205b1076d25"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const deviceKey = sessionStorage.getItem("deviceKey");

        if (!deviceKey) {
            alert("Please login first.");
            //window.location.href = "login.html";
        } else {
            db.ref("Devices/" + deviceKey).once("value").then(snapshot => {
                const data = snapshot.val();
                if (data) {
                    const dates = Object.keys(data);
                    const latestDate = dates[dates.length - 1];
                    const times = Object.keys(data[latestDate]);
                    const latestTime = times[times.length - 1];
                    const latest = data[latestDate][latestTime];

                    let alertShown = false;

                    if (latest.heartRate > 120 || latest.heartRate < 50) {
                        showNotification("heartAlert", "heart-time");
                        alertShown = true;
                    }

                    if (latest.objectTemperature > 38.5) {
                        showNotification("tempAlert", "temp-time");
                        alertShown = true;
                    }

                    if (latest.SpO2 < 92) {
                        showNotification("spo2Alert", "spo2-time");
                        alertShown = true;
                    }

                    if (!alertShown) {
                        showNotification("goodAlert", "good-time");
                    }
                }
            });
        }

        function showNotification(alertId, timeId) {
            const wrapper = document.getElementById(alertId);
            wrapper.classList.remove("d-none");
            document.getElementById(timeId).textContent = new Date().toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });

            const card = wrapper.querySelector(".notification-card");
            card.addEventListener("click", () => {
                card.classList.add("read");
            });

            handleSwipeToDelete(wrapper.querySelector(".swipe-content"), wrapper);
        }

        function handleSwipeToDelete(contentEl, wrapperEl) {
            let startX = 0;
            let currentX = 0;
            let swiping = false;

            contentEl.addEventListener("touchstart", e => {
                startX = e.touches[0].clientX;
                swiping = true;
            });

            contentEl.addEventListener("touchmove", e => {
                if (!swiping) return;
                currentX = e.touches[0].clientX;
                const deltaX = currentX - startX;
                contentEl.style.transform = `translateX(${deltaX}px)`;
            });

            contentEl.addEventListener("touchend", () => {
                swiping = false;
                const deltaX = currentX - startX;
                if (Math.abs(deltaX) > 100) {
                    contentEl.style.transition = "transform 0.3s ease-out";
                    contentEl.style.transform = `translateX(${deltaX > 0 ? '100%' : '-100%'})`;
                    setTimeout(() => {
                        wrapperEl.remove();
                    }, 300);
                } else {
                    contentEl.style.transform = "translateX(0)";
                }
            });
        }
    </script>

</body>

</html>
